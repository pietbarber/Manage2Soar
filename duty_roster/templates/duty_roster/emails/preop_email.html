<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-Operations Report for {{ target_date }}</title>
    <!--[if mso]>
    <style type="text/css">
        table { border-collapse: collapse; }
        td { padding: 0; }
    </style>
    <![endif]-->
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f5f5f5;">
    <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #f5f5f5;">
        <tr>
            <td align="center" style="padding: 20px 10px;">
                <!-- Main container -->
                <table role="presentation" width="600" cellpadding="0" cellspacing="0" style="max-width: 600px; width: 100%; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

                    <!-- Header with logo -->
                    <tr>
                        <td style="background-color: #2c5282; padding: 24px; text-align: center;">
                            {% if club_logo_url %}
                            <img src="{{ club_logo_url }}" alt="{{ club_name }}" style="max-height: 60px; max-width: 200px; height: auto; margin-bottom: 12px;">
                            {% endif %}
                            <h1 style="margin: 0; color: #ffffff; font-size: 24px; font-weight: 600;">
                                Pre-Operations Report
                            </h1>
                            <p style="margin: 8px 0 0 0; color: #bee3f8; font-size: 16px;">
                                {{ target_date|date:"l, F j, Y" }}
                            </p>
                        </td>
                    </tr>

                    <!-- Friendly reminder -->
                    <tr>
                        <td style="padding: 24px 24px 16px 24px;">
                            <p style="margin: 0; color: #2d3748; font-size: 16px; line-height: 1.5;">
                                Hello {{ club_nickname|default:club_name }} {% if is_participant %}Member{% else %}Duty Crew{% endif %},
                            </p>
                            <p style="margin: 12px 0 0 0; color: #4a5568; font-size: 15px; line-height: 1.5;">
                                {% if is_participant %}Operations are planned for {{ target_date|date:"l, j M Y" }}. You are receiving this notice because you indicated you plan to fly or receive instruction that day.{% elif days_until == 1 %}This is a friendly reminder that you are scheduled for duty tomorrow.{% elif days_until == 0 %}This is a reminder that you are scheduled for duty on {{ target_date|date:"l, j M Y" }}.{% elif days_until < 0 %}This is a summary of duty operations for {{ target_date|date:"l, F j" }}.{% else %}This is an advance notice that you are scheduled for duty on {{ target_date|date:"l, F j" }} ({{ days_until }} days from now).{% endif %}
                                Please review the information below and come prepared for a great day of flying!
                            </p>
                        </td>
                    </tr>

                    <!-- Duty Crew section -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #edf2f7; border-radius: 6px;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #2d3748; font-size: 18px; font-weight: 600;">
                                            Assigned Duty Crew
                                        </h2>
                                        <table role="presentation" width="100%" cellpadding="0" cellspacing="0">
                                            {% if instructor %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px; width: 140px;">{{ instructor_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ instructor.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                            {% if surge_instructor %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px;">{{ surge_instructor_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ surge_instructor.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                            {% if tow_pilot %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px;">{{ towpilot_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ tow_pilot.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                            {% if surge_tow_pilot %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px;">{{ surge_towpilot_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ surge_tow_pilot.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                            {% if duty_officer %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px;">{{ duty_officer_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ duty_officer.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                            {% if assistant_duty_officer %}
                                            <tr>
                                                <td style="padding: 4px 0; color: #718096; font-size: 14px;">{{ assistant_duty_officer_title }}:</td>
                                                <td style="padding: 4px 0; color: #2d3748; font-size: 14px; font-weight: 500;">{{ assistant_duty_officer.full_display_name }}</td>
                                            </tr>
                                            {% endif %}
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    {% if instruction_requests %}
                    <!-- Students requesting instruction -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #ebf8ff; border-radius: 6px; border-left: 4px solid #3182ce;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #2c5282; font-size: 18px; font-weight: 600;">
                                            Students Requesting Instruction
                                        </h2>
                                        <ul style="margin: 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for slot in instruction_requests %}
                                            <li>{{ slot.student.full_display_name }}{% if slot.status == "confirmed" %} <span style="color: #38a169;">(confirmed)</span>{% elif slot.status == "pending" %} <span style="color: #d69e2e;">(pending)</span>{% elif slot.status == "waitlist" %} <span style="color: #805ad5;">(waitlist)</span>{% endif %}</li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    {% if reservations %}
                    <!-- Glider Reservations (Issue #410) -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #e6fffa; border-radius: 6px; border-left: 4px solid #319795;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #234e52; font-size: 18px; font-weight: 600;">
                                            Glider Reservations
                                        </h2>
                                        <ul style="margin: 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for res in reservations %}
                                            <li>
                                                <strong>{{ res.glider }}</strong> - {{ res.member.full_display_name }}
                                                <span style="color: #718096;">
                                                    ({{ res.get_reservation_type_display }} -
                                                    {% if res.time_preference == "specific" and res.start_time %}{{ res.start_time|time:"g:i A" }}{% else %}{{ res.get_time_preference_display }}{% endif %})
                                                </span>
                                                {% if res.is_trainer %}<span style="color: #319795;"> [2-seater]</span>{% endif %}
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    {% if ops_intents %}
                    <!-- Members planning to fly -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #f0fff4; border-radius: 6px; border-left: 4px solid #38a169;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #276749; font-size: 18px; font-weight: 600;">
                                            Members Planning to Fly
                                        </h2>
                                        <ul style="margin: 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for intent in ops_intents %}
                                            <li>
                                                {{ intent.member.full_display_name }}
                                                {% if intent.available_as_labels %}
                                                <span style="color: #718096;">({{ intent.available_as_labels|join:", " }})</span>
                                                {% endif %}
                                                {% if intent.glider %}
                                                <span style="color: #718096;">- {{ intent.glider }}</span>
                                                {% endif %}
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    {% if grounded_gliders or grounded_towplanes %}
                    <!-- Grounded aircraft -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #fff5f5; border-radius: 6px; border-left: 4px solid #e53e3e;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #c53030; font-size: 18px; font-weight: 600;">
                                            Grounded Aircraft
                                        </h2>
                                        {% if grounded_gliders %}
                                        <p style="margin: 0 0 8px 0; color: #742a2a; font-size: 14px; font-weight: 600;">Gliders:</p>
                                        <ul style="margin: 0 0 12px 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for issue in grounded_gliders %}
                                            <li><strong>{{ issue.glider }}</strong> - {{ issue.description }}</li>
                                            {% endfor %}
                                        </ul>
                                        {% endif %}
                                        {% if grounded_towplanes %}
                                        <p style="margin: 0 0 8px 0; color: #742a2a; font-size: 14px; font-weight: 600;">Towplanes:</p>
                                        <ul style="margin: 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for issue in grounded_towplanes %}
                                            <li><strong>{{ issue.towplane }}</strong> - {{ issue.description }}</li>
                                            {% endfor %}
                                        </ul>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    {% if upcoming_deadlines %}
                    <!-- Upcoming maintenance deadlines -->
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #fffaf0; border-radius: 6px; border-left: 4px solid #dd6b20;">
                                <tr>
                                    <td style="padding: 16px;">
                                        <h2 style="margin: 0 0 12px 0; color: #c05621; font-size: 18px; font-weight: 600;">
                                            Maintenance Deadlines (Next 30 Days)
                                        </h2>
                                        <ul style="margin: 0; padding-left: 20px; color: #2d3748; font-size: 14px; line-height: 1.6;">
                                            {% for deadline in upcoming_deadlines %}
                                            <li>
                                                <strong>{% firstof deadline.glider deadline.towplane "Unknown" %}</strong>
                                                - {{ deadline.description }}
                                                <span style="color: #718096;">(due {{ deadline.due_date|date:"M j, Y" }})</span>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- No issues notice -->
                    {% if not grounded_gliders and not grounded_towplanes and not upcoming_deadlines %}
                    <tr>
                        <td style="padding: 0 24px 16px 24px;">
                            <table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background-color: #f0fff4; border-radius: 6px;">
                                <tr>
                                    <td style="padding: 16px; text-align: center;">
                                        <p style="margin: 0; color: #276749; font-size: 15px;">
                                            No grounded aircraft or upcoming maintenance deadlines. All systems go!
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    {% endif %}

                    <!-- CTA button -->
                    <tr>
                        <td style="padding: 8px 24px 24px 24px; text-align: center;">
                            <a href="{{ duty_roster_url }}" style="display: inline-block; background-color: #3182ce; color: #ffffff; text-decoration: none; padding: 12px 24px; border-radius: 6px; font-size: 15px; font-weight: 600;">
                                View Duty Roster
                            </a>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #edf2f7; padding: 20px 24px; text-align: center; border-top: 1px solid #e2e8f0;">
                            <p style="margin: 0 0 8px 0; color: #718096; font-size: 13px;">
                                This is an automated message from {{ club_name }}.
                            </p>
                            <p style="margin: 0; color: #a0aec0; font-size: 12px;">
                                <a href="{{ site_url }}" style="color: #4a5568; text-decoration: none;">{{ site_url }}</a>
                            </p>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
</body>
</html>
