{% extends "base.html" %}
{% load static %}
{% block title %}Duty Roster Calendar{% endblock %}

{% block content %}

    {% include "duty_roster/_calendar_body.html" %}
 
    
    <div class="modal fade" id="calendarModal" tabindex="-1" role="dialog" aria-labelledby="calendarModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="calendarModalLabel">Duty Day</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body">
              <!-- Loading spinner -->
              <div id="modal-loading" class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading duty information...</p>
              </div>
              <!-- HTMX content will load here -->
            </div>
          </div>
        </div>
      </div>

      <script>
        function showModalWithLoading() {
          // Clear any previous content and show loading state
          const modalBody = document.getElementById('modal-body');
          
          // Show only the loading spinner with smooth transition
          modalBody.innerHTML = `
            <div id="modal-loading" class="text-center py-4" style="opacity: 0;">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-3 text-muted">Loading duty information...</p>
            </div>
          `;
          
          // Show the modal
          bootstrap.Modal.getOrCreateInstance(document.getElementById('calendarModal')).show();
          
          // Fade in the loading spinner
          setTimeout(() => {
            const loadingDiv = document.getElementById('modal-loading');
            if (loadingDiv) {
              loadingDiv.style.transition = 'opacity 0.2s ease-in';
              loadingDiv.style.opacity = '1';
            }
          }, 50);
        }
        
        // Hide loading spinner when HTMX content loads
        document.body.addEventListener('htmx:afterRequest', function(event) {
          if (event.detail.target.id === 'modal-body') {
            // Content has loaded, remove loading state if it exists
            const loadingDiv = document.getElementById('modal-loading');
            if (loadingDiv) {
              loadingDiv.remove();
            }
          }
        });
        
        // Handle HTMX errors gracefully
        document.body.addEventListener('htmx:responseError', function(event) {
          if (event.detail.target.id === 'modal-body') {
            document.getElementById('modal-body').innerHTML = `
              <div class="text-center py-4">
                <div class="text-danger">
                  <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                  <p>Sorry, there was an error loading the duty information.</p>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            `;
          }
        });
      </script>
      
{% endblock %}
