# ============================================================
# Header Checks - Generated by Ansible
# ============================================================
# DO NOT EDIT MANUALLY - changes will be overwritten
# Managed by: infrastructure/ansible/roles/postfix/
#
# Purpose: Rewrite headers for mailing list traffic
# SMTP2GO requires verified sender domains, so we rewrite the
# From header to use our domain.
#
# Note: Reply-To is set by smtp_header_checks to enable reply-to-list behaviour,
# causing replies to go to the mailing list address rather than the original sender.

# ============================================================
# FROM HEADER REWRITING
# ============================================================
# Rewrite From headers from external domains to our list address.
# This is required because SMTP2GO only accepts mail from verified
# sender domains (ssc.manage2soar.com, etc.)
#
# Example transformation:
#   From: Piet Barber <pietbarber@yahoo.com>
#   Becomes: From: "SSC Members List" <members@ssc.manage2soar.com>

# Match any From header NOT from our domain and rewrite it
# The negative lookahead is anchored with > to prevent subdomain bypass
/^From:\s*"?[^"<]*"?\s*<[^@]+@(?!ssc\.manage2soar\.com>)[^>]+>/
    REPLACE From: "SSC Members List" <members@ssc.manage2soar.com>

# Fallback: catch From headers without angle brackets
# Anchored with whitespace or end-of-string to prevent subdomain bypass
/^From:\s*[^@]+@(?!ssc\.manage2soar\.com(?:\s|$))\S+/
    REPLACE From: "SSC Members List" <members@ssc.manage2soar.com>
