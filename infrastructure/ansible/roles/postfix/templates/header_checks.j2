# ============================================================
# Header Checks - Generated by Ansible
# ============================================================
# DO NOT EDIT MANUALLY - changes will be overwritten
# Managed by: infrastructure/ansible/roles/postfix/
#
# Purpose: Rewrite headers for mailing list traffic
# SMTP2GO requires verified sender domains, so we rewrite the
# From header to use our domain.
#
# Note: Reply-To preservation is handled by smtp_header_checks
# which captures the original sender before From is rewritten.

# ============================================================
# FROM HEADER REWRITING
# ============================================================
# Rewrite From headers from external domains to our list address.
# This is required because SMTP2GO only accepts mail from verified
# sender domains (ssc.manage2soar.com, etc.)
#
# Example transformation:
#   From: Piet Barber <pietbarber@yahoo.com>
#   Becomes: From: "SSC Members List" <members@ssc.manage2soar.com>

# Match any From header NOT from our domain and rewrite it
# Using simple regex - PCRE negative lookahead can be finicky
/^From:\s*"?([^"<]*)"?\s*<([^@]+)@(?!ssc\.manage2soar\.com)[^>]+>/
    REPLACE From: "$1 via SSC" <members@ssc.manage2soar.com>

# Fallback: catch From headers without angle brackets
/^From:\s*([^@]+)@(?!ssc\.manage2soar\.com)\S+/
    REPLACE From: "SSC Members List" <members@ssc.manage2soar.com>
