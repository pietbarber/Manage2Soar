# ============================================================
# OpenDKIM Configuration - Generated by Ansible
# ============================================================
# DO NOT EDIT MANUALLY - changes will be overwritten

# Logging
Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes

# Permissions
UserID                  opendkim:opendkim
UMask                   007

# Socket for Postfix communication
# Socket must be inside Postfix chroot for smtpd to access it
Socket                  local:/var/spool/postfix/opendkim/opendkim.sock

# Pid file
PidFile                 /run/opendkim/opendkim.pid

# Signing mode: sign outgoing, verify incoming
Mode                    sv

# Canonicalization (relaxed for headers, simple for body)
Canonicalization        relaxed/simple

# Key tables
KeyTable                refile:{{ opendkim_config_dir }}/KeyTable
SigningTable            refile:{{ opendkim_config_dir }}/SigningTable
ExternalIgnoreList      refile:{{ opendkim_config_dir }}/TrustedHosts
InternalHosts           refile:{{ opendkim_config_dir }}/TrustedHosts

# Signature algorithm
SignatureAlgorithm      rsa-sha256

# Don't sign mail from untrusted hosts
OversignHeaders         From

# What to do on errors
# Note: On-BadSignature is set to 'accept' to match current production policy
# and to avoid rejecting legitimate mail during DKIM troubleshooting or when
# external senders have misconfigured DKIM. Switching this to 'reject' would
# be a deliberate, stricter policy change and should only be done after
# thorough testing and stakeholder approval. (See Issue #532)
On-BadSignature         accept
On-DNSError             tempfail
On-InternalError        tempfail
On-NoSignature          accept
On-Security             tempfail
