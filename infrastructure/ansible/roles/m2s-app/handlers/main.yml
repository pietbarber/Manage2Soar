---
# M2S Application handlers

- name: Reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: Restart gunicorn
  ansible.builtin.systemd:
    name: gunicorn
    state: restarted

- name: Collect static files
  ansible.builtin.command:
    cmd: "{{ m2s_venv_path }}/bin/python manage.py collectstatic --noinput"
    chdir: "{{ m2s_app_home }}/app"
  environment:
    DJANGO_SETTINGS_MODULE: "{{ m2s_django_settings_module }}"
    DJANGO_SECRET_KEY: "{{ vault_django_secret_key }}"
    DJANGO_DEBUG: "{{ m2s_django_debug | string | lower }}"
    DB_NAME: "{{ m2s_db_name }}"
    DB_USER: "{{ m2s_db_user }}"
    DB_PASSWORD: "{{ vault_postgresql_password }}"
    DB_HOST: "{{ m2s_db_host }}"
    DB_PORT: "{{ m2s_db_port }}"
    CLUB_PREFIX: "{{ club_prefix | default('tsc') }}"
    STATIC_ROOT: "{{ m2s_django_static_root }}"
    MEDIA_ROOT: "{{ m2s_django_media_root }}"
  become: true
  become_user: "{{ m2s_app_user }}"
