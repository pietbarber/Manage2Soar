# Django environment configuration
# Managed by Ansible - DO NOT EDIT MANUALLY
# Environment variables expected by manage2soar/settings_single_host.py

# Django settings module
DJANGO_SETTINGS_MODULE={{ m2s_django_settings_module }}

# Debug mode
DJANGO_DEBUG={{ m2s_django_debug | string | lower }}

# Security settings
DJANGO_SECRET_KEY={{ vault_django_secret_key }}
ALLOWED_HOSTS={{ m2s_django_allowed_hosts }}
SSL_ENABLED={{ nginx_ssl_enabled | default(false) | string | lower }}

# Database configuration
DB_NAME={{ m2s_db_name }}
DB_USER={{ m2s_db_user }}
DB_PASSWORD={{ vault_postgresql_password }}
DB_HOST={{ m2s_db_host }}
DB_PORT={{ m2s_db_port }}

# Club prefix
CLUB_PREFIX={{ club_prefix | default('tsc') }}

# Static and media files
STATIC_ROOT={{ m2s_django_static_root }}
MEDIA_ROOT={{ m2s_django_media_root }}

# Email configuration
EMAIL_BACKEND={{ m2s_email_backend }}
EMAIL_HOST={{ m2s_email_host }}
EMAIL_PORT={{ m2s_email_port }}
EMAIL_USE_TLS={{ m2s_email_use_tls | string | lower }}
{% if vault_email_host_user is defined %}
EMAIL_HOST_USER={{ vault_email_host_user }}
EMAIL_HOST_PASSWORD={{ vault_email_host_password }}
{% endif %}
{% if m2s_default_from_email is defined %}
DEFAULT_FROM_EMAIL={{ m2s_default_from_email }}
{% endif %}

# Email dev mode - when true, redirects all emails to test address (or console if redirect not set)
# Set to false in production to deliver emails to real recipients
EMAIL_DEV_MODE={{ email_dev_mode | default(true) | string | lower }}
{% if email_dev_mode_redirect_to is defined %}
EMAIL_DEV_MODE_REDIRECT_TO={{ email_dev_mode_redirect_to }}
{% endif %}

# Google OAuth2
{% if m2s_google_oauth_enabled %}
  {%- if m2s_multi_tenant | default(false) -%}
    {#- Multi-tenant: Use per-tenant OAuth2 credentials -#}
    {%- set oauth_client_id_var = 'vault_google_oauth_client_id_' + club_prefix -%}
    {%- set oauth_client_secret_var = 'vault_google_oauth_client_secret_' + club_prefix -%}
    {%- set oauth_client_id = lookup('vars', oauth_client_id_var, default='') -%}
    {%- set oauth_client_secret = lookup('vars', oauth_client_secret_var, default='') -%}
    {%- if oauth_client_id | length > 0 -%}
SOCIAL_AUTH_GOOGLE_OAUTH2_KEY={{ oauth_client_id }}
SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET={{ oauth_client_secret }}
    {%- endif -%}
  {%- else -%}
    {#- Single-tenant: Use global OAuth2 credentials -#}
    {%- if vault_google_oauth_client_id is defined -%}
SOCIAL_AUTH_GOOGLE_OAUTH2_KEY={{ vault_google_oauth_client_id }}
SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET={{ vault_google_oauth_client_secret }}
    {%- endif -%}
  {%- endif -%}
{% endif %}

# Logging
DJANGO_LOG_FILE={{ m2s_django_log_file }}

# Cookie security settings
# SameSite cookie settings (default: Lax)
# - Lax: cookies sent with same-site requests and top-level navigation (recommended)
# - Strict: cookies only sent with same-site requests (more restrictive, may break functionality)
# - None: cookies sent with all requests (requires Secure flag, only for cross-domain scenarios)
#
# These settings help prevent CSRF attacks and Safari/iOS cookie issues
# Override in group_vars if needed: m2s_session_cookie_samesite, m2s_csrf_cookie_samesite
SESSION_COOKIE_SAMESITE={{ m2s_session_cookie_samesite | default('Lax') }}
CSRF_COOKIE_SAMESITE={{ m2s_csrf_cookie_samesite | default('Lax') }}

# Additional settings
{% for key, value in m2s_extra_env_vars.items() %}
{{ key }}={{ value }}
{% endfor %}
