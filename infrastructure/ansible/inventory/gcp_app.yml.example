# GCP App Deployment Inventory
#
# COPY THIS FILE AND CONFIGURE:
#   cp inventory/gcp_app.yml.example inventory/gcp_app.yml
#
# This inventory is used for deploying Django apps to GKE.
# Since GKE deployments run from localhost (using kubectl),
# no remote hosts are needed.
#
# Usage:
#   ansible-playbook -i inventory/gcp_app.yml \
#     --vault-password-file ~/.ansible_vault_pass \
#     playbooks/gcp-app-deploy.yml

---
all:
  hosts:
    localhost:
      ansible_connection: local
      ansible_python_interpreter: "{{ ansible_playbook_python }}"

  vars:
    # ============================================================
    # GCP PROJECT CONFIGURATION
    # ============================================================
    # WARNING: YOU MUST CHANGE THIS VALUE.
    # - Set this to your actual GCP project ID (e.g. "my-real-gcp-project").
    # - This value is also used as a GCS bucket name in deployment playbooks.
    # - Leaving it unset or as a placeholder will cause deployment failures
    #   or unexpected behavior.
    # NOTE: This example file intentionally leaves gcp_project blank to force
    #       explicit configuration. When you copy this to inventory/gcp_app.yml,
    #       you MUST set gcp_project to your real GCP project ID before running
    #       any playbooks. The playbook includes validation to reject empty values.
    gcp_project: ""
    gcp_region: "us-central1"
    gcp_zone: "us-central1-c"

    # ============================================================
    # GKE CLUSTER
    # ============================================================
    gke_cluster_name: "manage2soar-cluster"

    # ============================================================
    # APPLICATION
    # ============================================================
    gke_app_name: "manage2soar"
    gke_base_domain: "manage2soar.com"

    # ============================================================
    # DATABASE (internal GCP IP)
    # ============================================================
    # Replace with your actual database internal IP
    # Get from: gcloud compute instances describe m2s-database --zone=us-east1-b --format='get(networkInterfaces[0].networkIP)'
    postgresql_host: "192.0.2.1"

    # Optional: Connection pooling for persistent database connections
    # Default: 300 seconds (5 minutes) - reuse connections to reduce overhead
    # 0 = new connection per request (no pooling)
    # 600 = 10 minutes (aggressive pooling for high-traffic sites)
    # postgresql_conn_max_age: 300

    # ============================================================
    # MULTI-TENANT
    # ============================================================
    gke_multi_tenant: true

    # Define tenants with their domains
    # Each tenant can have:
    #   - domain: single domain (string) - backwards compatible
    #   - domains: multiple domains (list) - for migration scenarios
    #
    # Multi-domain example for customer migrations:
    #   1. Start with primary domain (e.g., ssc.manage2soar.com)
    #   2. Add customer's domain as alias (e.g., www.skylinesoaring.org)
    #   3. Both domains work simultaneously during transition
    #   4. Customer updates DNS at their own pace
    gke_tenants:
      - prefix: "ssc"
        name: "Skyline Soaring Club"
        # Multi-domain example (production domains for skylinesoaring.org)
        domains:
          - "ssc.manage2soar.com"          # Testing/staging domain
          - "skylinesoaring.org"            # Production apex domain
          - "www.skylinesoaring.org"        # Production www subdomain

      - prefix: "masa"
        name: "Mid-Atlantic Soaring Association"
        # Single domain (simple)
        domain: "masa.manage2soar.com"
        # OR multiple domains (for migrations):
        # domains:
        #   - "masa.manage2soar.com"          # Primary domain
        #   - "www.midatlanticsoaring.org"    # Alias (added during migration)

    # ============================================================
    # INGRESS (External Access)
    # ============================================================
    # Enable to expose the application via domain names
    gke_enable_ingress: false

    # TLS is enabled by default using Google-managed SSL certificates
    # These are free, automatic, and don't require cert-manager or Let's Encrypt
    # gke_enable_tls: true  # Default
