# M2S Master Vault - Single Source of Truth
#
# ⚠️  CRITICAL: This is the MASTER vault file - all other vaults are symlinks to this!
#
# This file is the canonical example vault definition.
# Other example or per-environment vault templates should treat THIS file as authoritative.
# If they differ, update the other files to match this example and its documentation.
#
# VAULT ARCHITECTURE: One Vault To Rule Them All
#
#   Master vault (YOU ARE HERE):
#     group_vars/localhost/vault.yml  ← MASTER (single source of truth)
#
#   Symlinked vaults (point to master):
#     group_vars/gcp_app/vault.yml → ../localhost/vault.yml
#     group_vars/gcp_provisioner/vault.yml → ../localhost/vault.yml
#
#   Specialized vaults (different structure):
#     group_vars/gcp_mail/vault.yml (SMTP2Go API credentials - different structure)
#     group_vars/single_host/vault.yml (dev/test - different vault password, deprecated)
#
# SETUP INSTRUCTIONS:
#
# 1. Create vault password file (if not already done):
#    echo "your-secure-vault-password" > ~/.ansible_vault_pass
#    chmod 600 ~/.ansible_vault_pass
#
# 2. Create the master vault from this template:
#    mkdir -p group_vars/localhost
#    cp group_vars/localhost.vault.yml.example group_vars/localhost/vault.yml
#    # Edit vault.yml and fill in real secrets
#    ansible-vault encrypt group_vars/localhost/vault.yml \
#      --vault-password-file ~/.ansible_vault_pass
#
# 3. Create symlinks from other locations:
#    mkdir -p group_vars/gcp_app
#    mkdir -p group_vars/gcp_provisioner
#    ln -sf ../localhost/vault.yml group_vars/gcp_app/vault.yml
#    ln -sf ../localhost/vault.yml group_vars/gcp_provisioner/vault.yml
#
# TO EDIT LATER:
#    ansible-vault edit group_vars/localhost/vault.yml \
#      --vault-password-file ~/.ansible_vault_pass
#
# TO VIEW:
#    ansible-vault view group_vars/localhost/vault.yml \
#      --vault-password-file ~/.ansible_vault_pass
#
# GENERATE SECRETS:
#   PostgreSQL password: openssl rand -base64 32
#   Django secret key: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
#   Mail API key: (get from K8s: kubectl get secret -n tenant-ssc manage2soar-env-ssc -o jsonpath='{.data.M2S_MAIL_API_KEY}' | base64 -d)
#   SMTP relay: (get from SMTP2Go dashboard)
#   OAuth: (get from Google Cloud Console)

---
# ============================================================
# DJANGO SECRETS
# ============================================================

# Django secret key (required, 50+ characters)
# Generate with: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
vault_django_secret_key: "REPLACE-ME-WITH-DJANGO-SECRET-KEY-FROM-GENERATOR"

# ============================================================
# PER-TENANT DJANGO SECRET KEYS (Multi-Tenant, Recommended)
# ============================================================
# When defined, the gke-deploy role uses vault_django_secret_key_<prefix>
# instead of the shared vault_django_secret_key above.
# This isolates session/CSRF/token signing per tenant.
# Generate each with: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
# Avoid $, ", \, <, >, {, }, | in the key value (YAML/shell quoting issues).

vault_django_secret_key_ssc: "REPLACE-WITH-SSC-SPECIFIC-SECRET-KEY"
vault_django_secret_key_masa: "REPLACE-WITH-MASA-SPECIFIC-SECRET-KEY"
# vault_django_secret_key_demo: "REPLACE-WITH-DEMO-SPECIFIC-SECRET-KEY"
# vault_django_secret_key_svs: "REPLACE-WITH-SVS-SPECIFIC-SECRET-KEY"

# ============================================================
# DJANGO SUPERUSER PASSWORDS (Multi-Tenant)
# ============================================================
# Generate with: openssl rand -base64 32
# Required when gke_create_superuser is true (one per tenant)

vault_django_superuser_password_ssc: "REPLACE-WITH-SSC-SUPERUSER-PASSWORD"
vault_django_superuser_password_masa: "REPLACE-WITH-MASA-SUPERUSER-PASSWORD"
# vault_django_superuser_password_nfss: "nfss-superuser-password-32-chars"

# ============================================================
# POSTGRESQL PASSWORDS
# ============================================================
# Generate with: openssl rand -base64 32

# Single-tenant mode password (deprecated)
vault_postgresql_password: "REPLACE-WITH-32-CHAR-PASSWORD"

# Multi-tenant passwords (one per club)
vault_postgresql_password_ssc: "REPLACE-WITH-SSC-DATABASE-PASSWORD"
vault_postgresql_password_masa: "REPLACE-WITH-MASA-DATABASE-PASSWORD"
# vault_postgresql_password_nfss: "nfss-database-password-32-chars"

# Backup encryption passphrase (AES-256-CBC, client-side, required when
# postgresql_backup_encryption_enabled: true).  Must be 64+ characters.
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(54))"
# Note: 54 bytes of randomness encode to ~72 URL-safe base64 characters (54 * 4/3),
#       which satisfies the 64+ character minimum.
# WARNING: Store a copy in a separate secrets manager - losing this means
#          encrypted backups cannot be restored.
vault_postgresql_backup_passphrase: "REPLACE-WITH-72-CHAR-RANDOM-PASSPHRASE-MINIMUM-64-CHARS"

# ============================================================
# MAIL CREDENTIALS
# ============================================================

# Django's direct SMTP API key (used by Django to send mail via SMTP2Go API)
# Get from K8s production: kubectl get secret -n tenant-ssc manage2soar-env-ssc -o jsonpath='{.data.M2S_MAIL_API_KEY}' | base64 -d
vault_smtp_password: "REPLACE-WITH-SMTP2GO-API-KEY"

# ============================================================
# SMTP RELAY CREDENTIALS (for Postfix mail server)
# ============================================================
# NOTE: These are DIFFERENT from Django's SMTP API key above
# Get from SMTP2Go dashboard → Settings → Users
# Used by Postfix to relay mail through [mail.smtp2go.com]:587

# External SMTP relay credentials (used by m2s-mail server)
vault_smtp_relay_username: "example-smtp-username"
vault_smtp_relay_password: "example-smtp-password-replace-with-real-value"

# SMTP auth password for the m2s-app user on the mail server
# (used by Postfix sasl_passwd for authenticated submission from Django)
# Generate with: openssl rand -base64 32
vault_smtp_auth_password_m2s_app: "REPLACE-WITH-STRONG-PASSWORD"

# M2S mail API key (used by the mail server to fetch member lists from the app)
# Generate with: openssl rand -base64 32
vault_m2s_api_key: "REPLACE-WITH-LONG-RANDOM-API-KEY"

# ============================================================
# GOOGLE OAUTH CREDENTIALS (OPTIONAL)
# ============================================================
# Get from: https://console.cloud.google.com/apis/credentials
# Leave commented out to disable Google OAuth login

# vault_google_oauth_client_id: "REPLACE-WITH-OAUTH-CLIENT-ID.apps.googleusercontent.com"
# vault_google_oauth_client_secret: "REPLACE-WITH-OAUTH-CLIENT-SECRET"

# ============================================================
# GCP SERVICE ACCOUNT CREDENTIALS (OPTIONAL)
# ============================================================
# Only needed for GCP API access (Cloud Storage, etc.)

# vault_gcp_project_id: "REPLACE-WITH-GCP-PROJECT-ID"
# vault_gcp_service_account_email: "REPLACE-WITH-SERVICE-ACCOUNT@project.iam.gserviceaccount.com"
# vault_gcp_service_account_key: "REPLACE-WITH-SERVICE-ACCOUNT-JSON-KEY"
