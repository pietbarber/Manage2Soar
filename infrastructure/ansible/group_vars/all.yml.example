# Ansible Variables for Manage2Soar Infrastructure
#
# COPY THIS FILE TO all.yml AND FILL IN YOUR VALUES
# all.yml is gitignored - never commit passwords or secrets
#
# Usage: cp all.yml.example all.yml && vim all.yml

---
# ============================================================
# MAIL SERVER CONFIGURATION
# ============================================================

# Primary mail server hostname
mail_hostname: "mail.manage2soar.com"

# Primary domain for sending
mail_domain: "manage2soar.com"

# Admin email for DMARC reports and postmaster
admin_email: "postmaster@manage2soar.com"

# Let's Encrypt email for TLS certificate notifications
letsencrypt_email: "ops@manage2soar.com"

# ============================================================
# CLUB SUBDOMAINS
# ============================================================
# List all clubs that will have email under manage2soar.com
# Each club gets: MX, SPF, DKIM, DMARC, and mailing lists

club_domains:
  - prefix: "ssc"
    name: "Skyline Soaring Club"
    # M2S API endpoint for this club's member lists
    api_url: "https://ssc.manage2soar.com/api/email-lists/"
    # Per-club API key (optional - falls back to m2s_api_key if not set)
    # For multi-tenant isolation, each club should have its own key
    # auth_token: "CLUB_SPECIFIC_API_KEY_HERE"

  - prefix: "masa"
    name: "Mid-Atlantic Soaring Association"
    api_url: "https://masa.manage2soar.com/api/email-lists/"
    # auth_token: "MASA_SPECIFIC_API_KEY_HERE"

  # Add more clubs as needed:
  # - prefix: "nfss"
  #   name: "Northern Florida Soaring Society"
  #   api_url: "https://nfss.manage2soar.com/api/email-lists/"
  #   auth_token: "NFSS_SPECIFIC_API_KEY_HERE"

# ============================================================
# M2S API AUTHENTICATION
# ============================================================
# Default API key for clubs that don't have their own auth_token
# For better multi-tenant isolation, prefer per-club auth_tokens above
# This should be a long random string, shared with M2S settings

m2s_api_key: "CHANGE_ME_TO_A_LONG_RANDOM_STRING"

# ============================================================
# DEVELOPMENT MODE - SAFETY VALVE
# ============================================================
# When enabled, ALL mailing list recipients are redirected to a single
# email address. This prevents accidental emails to real users during
# development and testing.
#
# Safe default: development mode is disabled.
# To enable development mode (redirect all emails to a test address), set:
#   dev_mode_enabled: true
#   dev_mode_redirect_to: "your_test_email@example.com"
# Only enable for development/testing environments!

dev_mode_enabled: false
dev_mode_redirect_to: ""

# ============================================================
# OUTBOUND RELAY (SMTP2GO / SendGrid / etc.)
# ============================================================
# GCP blocks outbound port 25, so we relay through a service
# Get these from your SMTP2GO dashboard under "Sending > SMTP Users"

smtp_relay_host: "mail.smtp2go.com"
smtp_relay_port: 587
smtp_relay_username: "YOUR_SMTP2GO_USERNAME"
smtp_relay_password: "YOUR_SMTP2GO_PASSWORD"

# ============================================================
# SMTP AUTHENTICATION (for M2S to send via this server)
# ============================================================
# Credentials that M2S Django app will use to send email
# NOTE: Django must use full username format: username@mail_domain
#       e.g., EMAIL_HOST_USER=m2s-app@manage2soar.com

smtp_auth_users:
  - username: "m2s-app"
    password: "CHANGE_ME_STRONG_PASSWORD"
    # Which domains this user can send from
    allowed_domains:
      - "ssc.manage2soar.com"
      - "masa.manage2soar.com"
      # Add all club domains

# ============================================================
# DKIM CONFIGURATION
# ============================================================
# DKIM selector (used in DNS record name)
dkim_selector: "mail"

# DKIM key size (2048 recommended, 1024 for compatibility)
dkim_key_size: 2048

# ============================================================
# FIREWALL / SECURITY
# ============================================================
# IPs allowed to relay through this server (M2S app servers)
# These are added to Postfix mynetworks

trusted_relay_ips:
  - "10.0.0.0/8"       # Internal GCP network
  - "35.192.0.0/12"    # GCP IP range (adjust as needed)
  # Add your Kubernetes cluster IPs

# ============================================================
# MONITORING (optional)
# ============================================================
# Email to receive Postfix queue alerts
alert_email: "ops@manage2soar.com"

# Threshold for queue size warning
queue_alert_threshold: 100

# ============================================================
# ADMIN SSH ACCESS
# ============================================================
# SSH public keys and IPs for co-webmasters with server access
#
# ⚠️  CRITICAL: This is the SINGLE SOURCE OF TRUTH for admin IPs
# ⚠️  All firewall rules reference this list - update here ONLY!
#
# To add a new co-webmaster:
# 1. Add their entry to admin_ssh_keys below
# 2. Run the appropriate playbook to update firewall rules:
#    Recommended (full playbook run, especially for new admins):
#      - Database: ansible-playbook -i inventory/gcp_database.yml playbooks/gcp-database.yml
#      - Mail: ansible-playbook -i inventory/gcp_mail.yml playbooks/gcp-mail-server.yml
#      - Provisioner: ansible-playbook -i inventory/gcp_provisioner.yml playbooks/gcp-provisioner.yml
#    Advanced (GCP firewall-only update, if you know no other changes are needed):
#      - ansible-playbook -i inventory/gcp_provisioner.yml playbooks/gcp-provisioner.yml --tags gcp-provision
#
# See docs/runbooks/ansible-playbook-guide.md for detailed instructions

admin_ssh_keys:
  - user: "your_username"
    name: "Your Full Name"
    key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAA... your_username@laptop"  # Get with: cat ~/.ssh/id_ed25519.pub
    ip: "203.0.113.10/32"  # Your public IP (get with: curl -4 ifconfig.me)

  # Add more co-webmasters as needed:
  # - user: "admin2"
  #   name: "Second Admin Name"
  #   key: "ssh-rsa AAAAB3NzaC1yc2E... admin2@workstation"
  #   ip: "198.51.100.20/32"

# Derived list of IPs for firewall rules (DO NOT EDIT - auto-generated from admin_ssh_keys)
# Use this variable in host-specific vars files like:
#   gcp_ssh_allowed_sources: "{{ admin_ssh_ips }}"
admin_ssh_ips: "{{ admin_ssh_keys | map(attribute='ip') | list }}"
