{% extends "base.html" %}
{% block content %}
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <div>
      <h1 style="margin:0">Resources</h1>
      <p style="margin:0.25rem 0 0 0">Browse top-level resource directories and files available to members.</p>
    </div>
    {% if can_create_page %}
      <div>
        <a class="btn btn-sm btn-success me-2" href="{% url 'cms:create_page' %}">+ Create Page</a>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'admin:cms_page_changelist' %}">⚙️ Admin</a>
      </div>
    {% endif %}
  </div>
  <table class="table table-sm table-striped">
    <thead>
      <tr><th>Directory</th><th>Resources</th><th>Access Control</th></tr>
    </thead>
    <tbody>
      {% if pages %}
        {% for item in pages %}
        <tr>
          <td>
            {% if item.can_view %}
              <a href="{{ item.page.get_absolute_url }}">{{ item.page.title }}</a>
            {% else %}
              {{ item.page.title }}
            {% endif %}
          </td>
          <td>{{ item.doc_count }}</td>
          <td>
            {% if item.page.is_public %}
              <span class="badge bg-success">Public</span>
            {% elif not item.has_role_restrictions %}
              <span class="badge bg-info">Members Only</span>
            {% else %}
              <span class="badge bg-warning text-dark">Role Restricted</span>
              {% for role in item.required_roles %}
                <span class="badge bg-secondary ms-1">{{ role }}</span>
              {% endfor %}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="3">
            <div class="alert alert-info mb-0">No resources or folders to display yet. Check back later or visit the <a href="/admin/">admin</a> to add content.</div>
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
{% endblock %}
